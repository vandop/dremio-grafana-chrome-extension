<!DOCTYPE html>
<html>

<head>
  <meta charset="utf-8">
  <style>
    body {
      width: 400px;
      min-height: 500px;
      margin: 0;
      padding: 20px;
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      font-size: 14px;
    }

    .header {
      text-align: center;
      margin-bottom: 20px;
      border-bottom: 1px solid #e0e0e0;
      padding-bottom: 15px;
    }

    .config-step {
      display: none;
      margin-bottom: 20px;
    }

    .config-step.active {
      display: block;
    }

    .form-group {
      margin-bottom: 15px;
    }

    label {
      display: block;
      margin-bottom: 5px;
      font-weight: 500;
      color: #333;
    }

    input,
    select,
    textarea {
      width: 100%;
      padding: 8px 12px;
      border: 1px solid #ddd;
      border-radius: 4px;
      font-size: 14px;
      box-sizing: border-box;
    }

    textarea {
      height: 80px;
      resize: vertical;
      font-family: monospace;
    }

    button {
      background: #007cba;
      color: white;
      border: none;
      padding: 10px 16px;
      border-radius: 4px;
      cursor: pointer;
      font-size: 14px;
      margin-right: 10px;
    }

    button:hover {
      background: #005a87;
    }

    button:disabled {
      background: #ccc;
      cursor: not-allowed;
    }

    .button-secondary {
      background: #6c757d;
    }

    .button-secondary:hover {
      background: #545b62;
    }

    .status-message {
      padding: 10px;
      border-radius: 4px;
      margin: 10px 0;
      display: none;
    }

    .status-success {
      background: #d4edda;
      color: #155724;
      border: 1px solid #c3e6cb;
    }

    .status-error {
      background: #f8d7da;
      color: #721c24;
      border: 1px solid #f5c6cb;
    }

    .status-info {
      background: #d1ecf1;
      color: #0c5460;
      border: 1px solid #bee5eb;
    }

    .navigation {
      display: flex;
      justify-content: space-between;
      margin-top: 20px;
      padding-top: 15px;
      border-top: 1px solid #e0e0e0;
    }

    .step-indicator {
      display: flex;
      justify-content: center;
      margin-bottom: 20px;
    }

    .step {
      width: 30px;
      height: 30px;
      border-radius: 50%;
      background: #e0e0e0;
      color: #666;
      display: flex;
      align-items: center;
      justify-content: center;
      margin: 0 5px;
      font-weight: bold;
    }

    .step.active {
      background: #007cba;
      color: white;
    }

    .step.completed {
      background: #28a745;
      color: white;
    }

    .auth-fields {
      display: none;
    }

    .auth-fields.active {
      display: block;
    }

    .cloud-only,
    .onprem-only {
      display: none;
    }

    .cloud-only.active,
    .onprem-only.active {
      display: block;
    }

    .query-preview {
      background: #f8f9fa;
      border: 1px solid #e9ecef;
      padding: 10px;
      border-radius: 4px;
      font-family: monospace;
      font-size: 12px;
      white-space: pre-wrap;
      max-height: 150px;
      overflow-y: auto;
    }
  </style>
</head>

<body>
  <div class="header">
    <h2>Grafana UUID Mapper</h2>
    <div class="step-indicator">
      <div class="step active" id="step-1">1</div>
      <div class="step" id="step-2">2</div>
      <div class="step" id="step-3">3</div>
    </div>
  </div>

  <!-- Step 1: Connection Configuration -->
  <div class="config-step active" id="connection-step">
    <h3>Dremio Connection</h3>

    <div class="form-group">
      <label for="dremio-type">Dremio Type</label>
      <select id="dremio-type">
        <option value="cloud">Dremio Cloud</option>
        <option value="onprem">On-Premise / Software</option>
      </select>
    </div>

    <div class="form-group">
      <label for="server-url">Server URL</label>
      <input type="url" id="server-url" placeholder="https://api.dremio.cloud" required>
      <small style="color: #666; font-size: 12px;">Cloud: https://api.dremio.cloud or
        https://api.eu.dremio.cloud</small>
    </div>

    <div class="form-group cloud-only">
      <label for="project-id">Project ID</label>
      <input type="text" id="project-id" placeholder="your-project-id-here">
      <small style="color: #666; font-size: 12px;">Found in Dremio Cloud project settings</small>
    </div>

    <div class="form-group onprem-only">
      <label for="port">Port</label>
      <input type="number" id="port" value="9047" min="1" max="65535">
    </div>

    <div class="form-group">
      <label for="auth-type">Authentication</label>
      <select id="auth-type">
        <option value="none">No Authentication</option>
        <option value="basic">Username/Password</option>
        <option value="token">API Token (Bearer)</option>
      </select>
    </div>

    <div class="auth-fields" id="basic-auth">
      <div class="form-group">
        <label for="username">Username</label>
        <input type="text" id="username" placeholder="Enter username">
      </div>
      <div class="form-group">
        <label for="password">Password</label>
        <input type="password" id="password" placeholder="Enter password">
      </div>
    </div>

    <div class="auth-fields" id="token-auth">
      <div class="form-group">
        <label for="token">API Token</label>
        <input type="password" id="token" placeholder="Enter API token">
      </div>
    </div>

    <button type="button" id="test-connection">Test Connection</button>
    <div class="status-message" id="connection-status"></div>
  </div>

  <!-- Step 2: Query Configuration -->
  <div class="config-step" id="query-step">
    <h3>Query Configuration</h3>

    <div class="form-group">
      <label for="table-name">Table/View Name</label>
      <input type="text" id="table-name" placeholder="your_mapping_table" required>
    </div>

    <h4>Column Mappings</h4>
    <div class="form-group">
      <label for="uuid-column">UUID Column</label>
      <input type="text" id="uuid-column" placeholder="uuid_column_name" required>
    </div>

    <div class="form-group">
      <label for="name-column">Name Column</label>
      <input type="text" id="name-column" placeholder="name_column_name" required>
    </div>

    <div class="form-group">
      <label for="desc-column">Description Column (Optional)</label>
      <input type="text" id="desc-column" placeholder="description_column">
    </div>

    <div class="form-group">
      <label for="timestamp-column">Timestamp Column (Optional)</label>
      <input type="text" id="timestamp-column" placeholder="timestamp_column">
    </div>

    <h4>Query Preview</h4>
    <div class="query-preview" id="query-preview"></div>

    <button type="button" id="test-query">Test Query</button>
    <div class="status-message" id="query-status"></div>
  </div>

  <!-- Step 3: Advanced Settings -->
  <div class="config-step" id="advanced-step">
    <h3>Advanced Settings</h3>

    <div class="form-group">
      <label for="cache-ttl">Cache Duration (minutes)</label>
      <input type="number" id="cache-ttl" value="60" min="1" max="1440">
    </div>

    <div class="form-group">
      <label for="batch-size">Batch Size</label>
      <input type="number" id="batch-size" value="50" min="1" max="100">
    </div>

    <div class="form-group">
      <label for="hover-delay">Hover Delay (ms)</label>
      <input type="number" id="hover-delay" value="300" min="0" max="2000">
    </div>

    <h4>Dremio Cloud Polling (for async queries)</h4>

    <div class="form-group">
      <label for="cloud-poll-delay">Initial Poll Delay (ms)</label>
      <input type="number" id="cloud-poll-delay" value="2000" min="500" max="10000">
      <small style="color: #666; font-size: 12px;">Wait time before first results check</small>
    </div>

    <div class="form-group">
      <label for="cloud-poll-interval">Poll Interval (ms)</label>
      <input type="number" id="cloud-poll-interval" value="1000" min="500" max="5000">
      <small style="color: #666; font-size: 12px;">Wait time between retry attempts</small>
    </div>

    <div class="form-group">
      <label for="cloud-max-attempts">Max Poll Attempts</label>
      <input type="number" id="cloud-max-attempts" value="30" min="3" max="60">
      <small style="color: #666; font-size: 12px;">Maximum number of retry attempts</small>
    </div>

    <div class="status-message" id="save-status"></div>
  </div>

  <div class="navigation">
    <button type="button" id="prev-btn" class="button-secondary" style="display: none;">Previous</button>
    <button type="button" id="next-btn">Next</button>
    <button type="button" id="save-btn" style="display: none;">Save Configuration</button>
  </div>

  <script src="popup.js"></script>
</body>

</html>